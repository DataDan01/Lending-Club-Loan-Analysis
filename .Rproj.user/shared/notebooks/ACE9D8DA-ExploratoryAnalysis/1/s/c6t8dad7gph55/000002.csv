"0","lib_load(""moments"")"
"0","## Generic function to create four descriptive plots for each loan grade --> Employment, State, Purpose, Amount"
"0","grade_plotter <- function(grade) {"
"0","  "
"0","  # Filtering for grade"
"0","  loan_data_tmp <- loan_data[loan_data$grade == grade,]"
"0","  ## Aggregating up total loans by job ##"
"0","  loan_by_emp <- loan_data_tmp %>% "
"0","                 group_by(emp_title) %>% "
"0","                 summarize(`Total Loans ($)` = sum(loan_amnt)) %>%"
"0","                 arrange(desc(`Total Loans ($)`))"
"0","  "
"0","  # Getting percentage information since we can only plot a subset"
"0","  loan_by_emp$emp_title <- paste0(loan_by_emp$emp_title,"" - "",paste0(round(100*loan_by_emp$`Total Loans ($)`/sum(loan_by_emp$`Total Loans ($)`),1),""%""))"
"0","  "
"0","  loan_by_emp_plot <- ggplot(loan_by_emp[1:10,], aes(x = reorder(emp_title,-`Total Loans ($)`), "
"0","                                                     y = (`Total Loans ($)`)/1e6, "
"0","                                                     fill = I(""dodgerblue4""),"
"0","                                                     alpha = I(rep(0.7,10)),"
"0","                                                     col = I(""grey29""))) + "
"0","                      geom_bar(stat = ""identity"") +"
"0","                      theme(axis.text.x = element_text(angle = 55, hjust = 1)) +"
"0","                      xlab(""Job Title - % of Total"") +"
"0","                      ylab(""Total Loans - Millions of $"")"
"0","  "
"0","  ## Aggregating up total loans by purpose ##"
"0","  loan_by_purp <- loan_data_tmp %>% "
"0","                  group_by(title) %>% "
"0","                  summarize(`Total Loans ($)` = sum(loan_amnt)) %>%"
"0","                  arrange(desc(`Total Loans ($)`))"
"0","  # Getting percentage information"
"0","  loan_by_purp$title <- paste0(loan_by_purp$title,"" - "",paste0(round(100*loan_by_purp$`Total Loans ($)`/sum(loan_by_purp$`Total Loans ($)`),1),""%""))"
"0","  "
"0","  loan_by_purp_plot <- ggplot(loan_by_purp, aes(x = reorder(title,-`Total Loans ($)`), "
"0","                                                y = (`Total Loans ($)`)/1e6, "
"0","                                                fill = I(""dodgerblue4""),"
"0","                                                alpha = I(rep(0.7,12)),"
"0","                                                col = I(""grey29""))) + "
"0","                     geom_bar(stat = ""identity"") +"
"0","                     theme(axis.text.x = element_text(angle = 55, hjust = 1)) +"
"0","                     xlab(""Purpose"") +"
"0","                     ylab(NULL)"
"0","  "
"0","  ## Aggregating up total loans by state ##"
"0","  loan_by_state <- loan_data_tmp %>% "
"0","                   group_by(addr_state) %>% "
"0","                   summarize(`Total Loans ($)` = sum(loan_amnt)) %>%"
"0","                   arrange(desc(`Total Loans ($)`))  "
"0","  "
"0","  # Finding full state names, capitalizing first letter of each one"
"0","  loan_by_state$addr_state <- sapply(loan_by_state$addr_state, function(state_code) {"
"0","    "
"0","    inx <- grep(pattern = state_code, x = state.regions$abb)"
"0","    "
"0","    state.regions$region[inx]"
"0","  "
"0","  }, USE.NAMES = F)"
"0","  "
"0","  # Borrowed from: https://stackoverflow.com/questions/6364783/capitalize-the-first-letter-of-both-words-in-a-two-word-string"
"0","  loan_by_state$addr_state <- sapply(loan_by_state$addr_state, function(state_name) {"
"0","    "
"0","    split <- strsplit(x=state_name, "" "")[[1]]"
"0","    "
"0","      paste(toupper(substring(split, 1,1)), "
"0","            substring(split, 2), sep="""", collapse="" "")"
"0","  }, USE.NAMES = F)"
"0","  "
"0","  # Getting percentage information especially since we can only plot a subset"
"0","  loan_by_state$addr_state <- paste0(loan_by_state$addr_state,"" - "",paste0(round(100*loan_by_state$`Total Loans ($)`/sum(loan_by_state$`Total Loans ($)`),1),""%""))"
"0","  "
"0","  loan_by_state_plot <- ggplot(loan_by_state[1:10,], aes(x = reorder(addr_state,-`Total Loans ($)`), "
"0","                                                         y = (`Total Loans ($)`)/1e6, "
"0","                                                         fill = I(""dodgerblue4""),"
"0","                                                         alpha = I(rep(0.7,10)),"
"0","                                                         col = I(""grey29""))) + "
"0","                    geom_bar(stat = ""identity"") +"
"0","                    theme(axis.text.x = element_text(angle = 55, hjust = 1)) +"
"0","                    xlab(""State - % of Total"") +"
"0","                    ylab(""Total Loans - Millions of $"")"
"0","  "
"0","  ## Aggregating up by loan amount ##"
"0","  loan_amnt_tmp <- loan_data_tmp$loan_amnt"
"0","  "
"0","  loan_amnt_hist <- qplot(loan_amnt_tmp, fill = I(""dodgerblue4""), "
"0","                           alpha = I(0.7), col = I(""grey29"")) + xlab(""Loan Amount"") + ylab(""Count"") + "
"0","                            geom_vline(aes(xintercept = mean(loan_amnt_tmp)), "
"0","                                       color = ""dodgerblue4"", "
"0","                                       linetype = ""dashed"", "
"0","                                       size = 2) +"
"0","                            annotate(""text"", x = Inf, y = Inf, "
"0","                                     label = sprintf(""\n Mean: %s  \n Average Deviation: %s   \n Skewness: %s   \n Kurtosis: %s   "","
"0","                                                     round(mean(loan_amnt_tmp)),"
"0","                                                     round(mean(abs(loan_amnt_tmp-mean(loan_amnt_tmp)))),"
"0","                                                     round(skewness(loan_amnt_tmp),2),"
"0","                                                     round(kurtosis(loan_amnt_tmp),2)), "
"0","                                     vjust = 1, hjust = 1)"
"0","  "
"0","  # Arranging plots into grid"
"0","  grid.arrange(loan_by_emp_plot, loan_by_purp_plot, loan_by_state_plot, loan_amnt_hist,"
"0","               widths = c(4,4), heights = c(4,3),   "
"0","               top = textGrob(sprintf(""Grade %s Loan Volume by Employment, Purpose, State, and Counts"",grade)))"
"0","  "
"0","  return(NULL)"
"0","}"
"0","# This seems to be a bug, but R errors out due on an obscure dplyr issue that is resolved with:"
"0","# 1) Restarting the R session at this point"
"0","# 2) Running library(ggplot2); library(dplyr); library(gridExtra); library(moments); library(grid)"
"0","# 3) Running the rest of the chunks"
